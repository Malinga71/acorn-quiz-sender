<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Sender â€” Acorn Group</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
:root {
  --bg: #0e0f0f;
  --surface: #161818;
  --border: #2a2d2d;
  --accent: #c9f53b;
  --accent-dim: #a8d124;
  --text: #e8eaea;
  --muted: #6b7070;
  --sent: #3bf5a0;
  --reminded: #f5c23b;
  --pending: #f5613b;
  --radius: 10px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; padding: 40px 24px; }
header { max-width: 900px; margin: 0 auto 48px; display: flex; align-items: flex-end; justify-content: space-between; border-bottom: 1px solid var(--border); padding-bottom: 24px; }
.brand { font-family: 'DM Serif Display', serif; font-size: 28px; letter-spacing: -0.5px; }
.brand span { color: var(--accent); }
.quiz-pill { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--muted); background: var(--surface); border: 1px solid var(--border); padding: 6px 12px; border-radius: 20px; }
main { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; }
.card-title { font-family: 'DM Serif Display', serif; font-size: 18px; margin-bottom: 6px; }
.card-subtitle { font-size: 13px; color: var(--muted); margin-bottom: 20px; line-height: 1.5; }
textarea { width: 100%; height: 160px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 13px; padding: 14px; resize: vertical; outline: none; transition: border-color 0.2s; line-height: 1.8; }
textarea:focus { border-color: var(--accent); }
textarea::placeholder { color: var(--muted); }
.btn-send { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px 22px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; border: none; background: var(--accent); color: #0e0f0f; margin-top: 16px; transition: background 0.2s; }
.btn-send:hover { background: var(--accent-dim); }
.btn-send:disabled { opacity: 0.4; cursor: not-allowed; }
.btn-remind { background: transparent; border: 1px solid var(--reminded); color: var(--reminded); padding: 6px 12px; font-size: 12px; border-radius: 6px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; transition: background 0.2s; }
.btn-remind:hover { background: rgba(245,194,59,0.1); }
.stats { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
.stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px 24px; display: flex; align-items: center; gap: 16px; }
.stat-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.stat-number { font-family: 'DM Serif Display', serif; font-size: 32px; line-height: 1; }
.stat-label { font-size: 12px; color: var(--muted); margin-top: 4px; text-transform: uppercase; letter-spacing: 0.08em; }
.tracker { grid-column: 1 / -1; }
.tracker-header { display: grid; grid-template-columns: 1fr 120px 140px 100px; gap: 12px; padding: 0 16px 12px; font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; border-bottom: 1px solid var(--border); }
.tracker-row { display: grid; grid-template-columns: 1fr 120px 140px 100px; gap: 12px; padding: 14px 16px; border-bottom: 1px solid var(--border); align-items: center; }
.tracker-row:last-child { border-bottom: none; }
.email-text { font-family: 'DM Mono', monospace; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.badge { display: inline-flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 500; padding: 4px 10px; border-radius: 20px; }
.badge::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
.badge-sent { color: var(--sent); background: rgba(59,245,160,0.08); }
.badge-reminded { color: var(--reminded); background: rgba(245,194,59,0.08); }
.time-text { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--muted); }
.empty-state { text-align: center; padding: 48px 24px; color: var(--muted); font-size: 14px; }
.empty-state .icon { font-size: 32px; margin-bottom: 12px; }
#toast { position: fixed; bottom: 24px; right: 24px; background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 14px 20px; border-radius: 10px; font-size: 14px; opacity: 0; transform: translateY(8px); transition: all 0.3s; pointer-events: none; z-index: 100; max-width: 320px; }
#toast.show { opacity: 1; transform: translateY(0); }
#toast.success { border-color: var(--sent); }
#toast.error { border-color: var(--pending); }
.progress-bar { height: 3px; background: var(--border); border-radius: 2px; margin-top: 14px; overflow: hidden; display: none; }
.progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.3s; width: 0%; }
</style>
</head>
<body>

<header>
  <div class="brand">Acorn <span>Quiz</span> Sender</div>
  <div class="quiz-pill">Transformation Governance Quiz</div>
</header>

<main>
  <div class="stats">
    <div class="stat-card">
      <div class="stat-dot" style="background:var(--sent)"></div>
      <div>
        <div class="stat-number" id="stat-sent" style="color:var(--sent)">0</div>
        <div class="stat-label">Sent</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-dot" style="background:var(--reminded)"></div>
      <div>
        <div class="stat-number" id="stat-reminded" style="color:var(--reminded)">0</div>
        <div class="stat-label">Reminded</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-dot" style="background:var(--pending)"></div>
      <div>
        <div class="stat-number" id="stat-total" style="color:var(--pending)">0</div>
        <div class="stat-label">Total</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">Send Quiz</div>
    <div class="card-subtitle">Paste email addresses below, one per line.</div>
    <textarea id="email-input" placeholder="john@example.com&#10;sarah@company.com&#10;mike@acorn.lk"></textarea>
    <div class="progress-bar" id="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <button class="btn-send" id="send-btn">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      Send to All
    </button>
  </div>

  <div class="card">
    <div class="card-title">How it works</div>
    <div class="card-subtitle">Each recipient receives a personalised email via your Outlook account.</div>
    <div style="display:flex;flex-direction:column;gap:16px;margin-top:8px">
      <div style="display:flex;gap:12px"><div style="width:24px;height:24px;border-radius:50%;background:var(--accent);color:#0e0f0f;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0">1</div><div><div style="font-size:14px;font-weight:500;margin-bottom:3px">Paste emails &amp; send</div><div style="font-size:13px;color:var(--muted)">Sent one by one via EmailJS through your Outlook account.</div></div></div>
      <div style="display:flex;gap:12px"><div style="width:24px;height:24px;border-radius:50%;background:var(--accent);color:#0e0f0f;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0">2</div><div><div style="font-size:14px;font-weight:500;margin-bottom:3px">Track status below</div><div style="font-size:13px;color:var(--muted)">All recipients appear in the tracker. Saved in your browser.</div></div></div>
      <div style="display:flex;gap:12px"><div style="width:24px;height:24px;border-radius:50%;background:var(--accent);color:#0e0f0f;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0">3</div><div><div style="font-size:14px;font-weight:500;margin-bottom:3px">Send reminders</div><div style="font-size:13px;color:var(--muted)">Click Remind next to anyone who hasn't responded.</div></div></div>
      <div style="display:flex;gap:12px"><div style="width:24px;height:24px;border-radius:50%;background:var(--accent);color:#0e0f0f;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0">4</div><div><div style="font-size:14px;font-weight:500;margin-bottom:3px">Receive responses</div><div style="font-size:13px;color:var(--muted)">Responses emailed to <span style="font-family:'DM Mono',monospace;color:var(--accent)">malinga@acorn.lk</span></div></div></div>
    </div>
  </div>

  <div class="card tracker">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <div>
        <div class="card-title">Recipient Tracker</div>
        <div class="card-subtitle" style="margin-bottom:0">Live status of all quiz invitations.</div>
      </div>
      <button id="clear-btn" style="background:transparent;border:1px solid var(--border);color:var(--muted);font-size:12px;padding:8px 14px;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif">Clear All</button>
    </div>
    <div class="tracker-header">
      <div>Email</div><div>Status</div><div>Sent At</div><div>Action</div>
    </div>
    <div id="tracker-body">
      <div class="empty-state"><div class="icon">ðŸ“­</div>No recipients yet.</div>
    </div>
  </div>
</main>

<div id="toast"></div>

<script>
(function() {
  var PK  = '0f263S7NiBXIl41mM';
  var SID = 'service_rc2b7fj';
  var TID = 'template_iphmejl';
  var URL = 'https://claude.ai/public/artifacts/c6595e2d-120f-4c81-be22-0acd047c49d3';
  var KEY = 'acorn_quiz_recipients';

  emailjs.init(PK);

  var recipients = [];
  try { recipients = JSON.parse(localStorage.getItem(KEY)) || []; } catch(e) {}

  function save() { localStorage.setItem(KEY, JSON.stringify(recipients)); }

  function fmt(ts) {
    if (!ts) return '-';
    var d = new Date(ts);
    return d.toLocaleDateString('en-GB',{day:'2-digit',month:'short'}) + ' ' + d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
  }

  function render() {
    var body = document.getElementById('tracker-body');
    if (recipients.length === 0) {
      body.innerHTML = '<div class="empty-state"><div class="icon">ðŸ“­</div>No recipients yet.</div>';
    } else {
      body.innerHTML = recipients.map(function(r,i) {
        return '<div class="tracker-row">' +
          '<div class="email-text">' + r.email + '</div>' +
          '<div><span class="badge badge-' + r.status + '">' + (r.status==='sent'?'Sent':'Reminded') + '</span></div>' +
          '<div class="time-text">' + fmt(r.sentAt) + '</div>' +
          '<div><button class="btn-remind" data-i="' + i + '">' + (r.status==='reminded'?'Re-remind':'Remind') + '</button></div>' +
          '</div>';
      }).join('');
    }
    document.getElementById('stat-sent').textContent = recipients.filter(function(r){return r.status==='sent';}).length;
    document.getElementById('stat-reminded').textContent = recipients.filter(function(r){return r.status==='reminded';}).length;
    document.getElementById('stat-total').textContent = recipients.length;
  }

  function toast(msg, type) {
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'show ' + (type||'success');
    setTimeout(function(){ t.className=''; }, 3500);
  }

  function sendQuiz() {
    var raw = document.getElementById('email-input').value.trim();
    if (!raw) { toast('Please paste at least one email.', 'error'); return; }

    var all = raw.split('\n').map(function(e){return e.trim().toLowerCase();})
      .filter(function(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);});
    all = all.filter(function(e,i){return all.indexOf(e)===i;});

    if (!all.length) { toast('No valid emails found.', 'error'); return; }

    var newOnes = all.filter(function(e){return !recipients.find(function(r){return r.email===e;});});
    if (!newOnes.length) { toast('All emails already sent to.', 'error'); return; }

    var btn = document.getElementById('send-btn');
    var bar = document.getElementById('progress-bar');
    var fill = document.getElementById('progress-fill');
    btn.disabled = true;
    btn.textContent = 'Sending...';
    bar.style.display = 'block';

    var i = 0, sent = 0, failed = 0;

    function next() {
      if (i >= newOnes.length) {
        bar.style.display = 'none';
        btn.disabled = false;
        btn.innerHTML = '<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg> Send to All';
        document.getElementById('email-input').value = '';
        toast(failed===0 ? 'Sent to ' + sent + ' recipient' + (sent>1?'s':'') + '!' : 'Sent: '+sent+', Failed: '+failed, failed===0?'success':'error');
        return;
      }
      fill.style.width = ((i+1)/newOnes.length*100)+'%';
      emailjs.send(SID, TID, {
        to_email: newOnes[i],
        subject: 'Transformation Governance Quiz',
        message: 'This is a simple quiz to test your understanding of transformation governance. Please click the link below and answer the questions.',
        quiz_link: URL,
        from_name: 'Malinga Arsakularatne'
      }).then(function(){
        recipients.push({email:newOnes[i],status:'sent',sentAt:Date.now()});
        sent++; save(); render(); i++; setTimeout(next,300);
      }, function(err){
        console.error('Failed:', newOnes[i], err);
        failed++; i++; setTimeout(next,300);
      });
    }
    next();
  }

  function sendReminder(idx) {
    var r = recipients[idx];
    emailjs.send(SID, TID, {
      to_email: r.email,
      subject: 'Reminder: Transformation Governance Quiz',
      message: 'This is a friendly reminder to complete the Transformation Governance Quiz. Please click the link below when you get a chance.',
      quiz_link: URL,
      from_name: 'Malinga Arsakularatne'
    }).then(function(){
      recipients[idx].status = 'reminded';
      recipients[idx].remindedAt = Date.now();
      save(); render();
      toast('Reminder sent to ' + r.email, 'success');
    }, function(err){
      console.error('Reminder failed:', err);
      toast('Failed to send reminder.', 'error');
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    render();

    document.getElementById('send-btn').addEventListener('click', sendQuiz);

    document.getElementById('clear-btn').addEventListener('click', function() {
      if (!confirm('Clear all data? This cannot be undone.')) return;
      recipients = []; save(); render();
      toast('Cleared.', 'success');
    });

    document.getElementById('tracker-body').addEventListener('click', function(e) {
      var btn = e.target.closest('.btn-remind');
      if (btn) sendReminder(parseInt(btn.getAttribute('data-i')));
    });
  });

})();
</script>
</body>
</html>